<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busca de Produtos</title>
    <!-- Importando Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .carousel {
            scroll-snap-type: x mandatory;
            overflow-x: hidden;
            display: flex;
            scroll-behavior: smooth;
        }
        .carousel-item {
            scroll-snap-align: center;
            flex: none;
            width: 100%;
        }
        .dropdown-results {
            z-index: 10;
            position: absolute;
            left: 0;
            top: 100%;
            width: 100%;
            background-color: white;
        }
        .carousel-container {
            margin-top: 80px;
        }
        #product-modal {
            z-index: 20;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    {% load static %}
    <header class="bg-gray-100 py-4 flex items-center justify-between relative">
        <div class="pl-8">
            <img src="{% static 'images/logo-belenus.png' %}" alt="Logo Belenus" class="w-auto h-14">
        </div>
        <div class="flex-grow text-center">
            <h1 class="text-3xl font-bold text-gray-800">Belenus Produtos</h1>
        </div>
        <div class="pr-8">
            <img src="{% static 'images/logo-fusofix.png' %}" alt="Logo Fusofix" class="w-auto h-14">
        </div>
    </header>
    <div class="bg-yellow-400 w-full flex justify-center py-2">
        <img src="{% static 'images/Container.svg' %}" alt="Header Icons" class="w-auto h-12">
    </div>
    <div class="bg-yellow-400 w-full py-4">
        <div class="container mx-auto flex flex-col items-center relative">
            <form method="get" id="search-form" class="w-1/2 flex items-center relative">
                <input 
                    type="text" 
                    id="search-input"
                    name="q" 
                    placeholder="Realize sua busca por código ou descrição..." 
                    value="{{ query }}"
                    class="w-full h-[38px] px-4 py-2 border border-gray-300 rounded-l shadow-sm focus:outline-none focus:ring-2 focus:ring-yellow-500"
                    autocomplete="off"
                >
                <button 
                    type="submit" 
                    class="h-[38px] w-[38px] bg-gray-800 text-white rounded-r flex items-center justify-center hover:bg-gray-700"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001a1.007 1.007 0 0 0-.102.102l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.102-.102zm-5.242.656a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11z"/>
                    </svg>
                </button>
            </form>
            <ul 
                id="search-results" 
                class="dropdown-results hidden border border-gray-300 rounded shadow-lg"
            ></ul>
        </div>
    </div>
    <div class="carousel-container">
        <div class="relative">
            <div class="carousel" id="carousel">
                <div class="carousel-item">
                    <img src="{% static 'images/belenus.jpg' %}" alt="Imagem 1" class="w-full h-auto">
                </div>
                <div class="carousel-item">
                    <img src="{% static 'images/belfit.jpg' %}" alt="Imagem 2" class="w-full h-auto">
                </div>
                <div class="carousel-item">
                    <img src="{% static 'images/belfit2.jpg' %}" alt="Imagem 3" class="w-full h-auto">
                </div>
                <div class="carousel-item">
                    <img src="{% static 'images/beltools.jpg' %}" alt="Imagem 4" class="w-full h-auto">
                </div>
            </div>
            <div class="absolute top-1/2 left-4 transform -translate-y-1/2">
                <button id="prev" class="p-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-8 h-8 text-yellow-500 hover:text-yellow-600">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
            </div>
            <div class="absolute top-1/2 right-4 transform -translate-y-1/2">
                <button id="next" class="p-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-8 h-8 text-yellow-500 hover:text-yellow-600">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Produto -->
    <div id="product-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-1/2 relative">
            <button id="close-modal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">&times;</button>
            <div id="modal-content">
                <!-- Detalhes do produto -->
            </div>
            <div class="mt-4 flex items-center justify-between">
                <input 
                    type="number" 
                    id="quantity-input" 
                    class="w-16 h-10 border border-gray-300 rounded px-2 text-center" 
                    value="1" 
                    min="1"
                >
                <button 
                    id="add-to-order" 
                    class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded shadow"
                >
                    Adicionar ao Pedido
                </button>
            </div>
        </div>
    </div>

    <!-- Resumo do Pedido -->
    <div id="order-summary" class="bg-white rounded shadow p-4 mt-4 container mx-auto hidden">
        <h2 class="text-xl font-bold mb-4">Resumo do Pedido</h2>
        <ul id="order-items" class="space-y-2">
            <!-- Produtos adicionados serão exibidos aqui -->
        </ul>
        <p class="text-lg font-bold mt-4">Total: <span id="order-total">R$ 0.00</span></p>
    </div>

    
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const searchInput = document.getElementById("search-input");
            const searchResults = document.getElementById("search-results");
            const productModal = document.getElementById("product-modal");
            const modalContent = document.getElementById("modal-content");
            const closeModal = document.getElementById("close-modal");
            const quantityInput = document.getElementById("quantity-input");
            const addToOrderButton = document.getElementById("add-to-order");
            const orderSummary = document.getElementById("order-summary");
            const orderItems = document.getElementById("order-items");
            const orderTotal = document.getElementById("order-total");

            let currentProduct = null;
            let order = [];

            // Busca dinâmica
            searchInput.addEventListener("input", async () => {
                const query = searchInput.value.trim();
                searchResults.innerHTML = "";

                if (query.length > 2) {
                    const response = await fetch(`/api/search?q=${query}`);
                    const produtos = await response.json();

                    if (produtos.length > 0) {
                        searchResults.classList.remove("hidden");
                        produtos.forEach(produto => {
                            const li = document.createElement("li");
                            li.innerHTML = `
                                <div class="px-4 py-2 hover:bg-gray-200 cursor-pointer">
                                    <strong>${produto.descricao}</strong>
                                    <span>(Código: ${produto.codigo_do_produto})</span>
                                </div>
                            `;
                            li.addEventListener("click", () => {
                                currentProduct = produto;
                                modalContent.innerHTML = `
                                    <h2 class="text-xl font-bold">${produto.descricao}</h2>
                                    <p><strong>Código:</strong> ${produto.codigo_do_produto}</p>
                                    <p><strong>Quantidade Disponível:</strong> ${produto.quantidade}</p>
                                    <p><strong>Valor Unitário:</strong> R$ ${produto.valor_unitario}</p>
                                `;
                                quantityInput.value = 1;
                                productModal.classList.remove("hidden");
                                searchResults.classList.add("hidden");
                            });
                            searchResults.appendChild(li);
                        });
                    } else {
                        const li = document.createElement("li");
                        li.textContent = "Nenhum resultado encontrado.";
                        li.className = "px-4 py-2 text-gray-500";
                        searchResults.appendChild(li);
                    }
                } else {
                    searchResults.classList.add("hidden");
                }
            });

            // Fechar modal
            closeModal.addEventListener("click", () => {
                productModal.classList.add("hidden");
            });

            // Adicionar ao pedido
            addToOrderButton.addEventListener("click", () => {
                const quantity = parseInt(quantityInput.value, 10);
                if (quantity > 0 && currentProduct) {
                    const productInOrder = order.find(item => item.codigo === currentProduct.codigo_do_produto);
                    if (productInOrder) {
                        productInOrder.quantidade += quantity;
                        productInOrder.total += currentProduct.valor_unitario * quantity;
                    } else {
                        order.push({
                            descricao: currentProduct.descricao,
                            codigo: currentProduct.codigo_do_produto,
                            quantidade: quantity,
                            total: currentProduct.valor_unitario * quantity
                        });
                    }
                    updateOrderSummary();
                    productModal.classList.add("hidden");
                }
            });

            // Atualizar resumo do pedido
            function updateOrderSummary() {
                orderItems.innerHTML = "";
                let total = 0;

                order.forEach(item => {
                    total += item.total;
                    const li = document.createElement("li");
                    li.innerHTML = `
                        <div class="flex justify-between">
                            <div>
                                <strong>${item.descricao}</strong> (Código: ${item.codigo})
                                <p>Quantidade: ${item.quantidade}</p>
                            </div>
                            <div>
                                <p>R$ ${item.total.toFixed(2)}</p>
                            </div>
                        </div>
                    `;
                    orderItems.appendChild(li);
                });

                orderTotal.textContent = `R$ ${total.toFixed(2)}`;
                orderSummary.classList.remove("hidden");
            }
        });
    </script>
</body>
</html>
